<!DOCTYPE html>
<html lang="es">
<head>  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descargar Actividad - Todo List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #17a2b8;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --gray-color: #95a5a6;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--light-color);
            text-decoration: none;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .back-link:hover {
            color: var(--primary-color);
        }
        
        .content {
            padding: 30px;
        }
        
        .activity-preview {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-color);
        }
        
        .activity-preview h2 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .preview-item {
            margin-bottom: 10px;
            display: flex;
        }
        
        .preview-label {
            font-weight: 600;
            min-width: 120px;
            color: var(--dark-color);
        }
        
        .preview-value {
            flex: 1;
        }
        
        .download-options {
            margin-bottom: 30px;
        }
        
        .download-options h2 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .option-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            border: 1px solid #e9ecef;
            transition: var(--transition);
            text-align: center;
        }
        
        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .option-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .option-card h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .option-card p {
            color: var(--gray-color);
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            transition: var(--transition);
            font-size: 16px;
            width: 100%;
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-dark {
            background-color: var(--dark-color);
            color: white;
        }
        
        .btn-dark:hover {
            background-color: #2c3e50;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .additional-options {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .additional-options h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .additional-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .additional-buttons .btn {
            width: auto;
            flex: 1;
            min-width: 150px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-inprogress {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .additional-buttons {
                flex-direction: column;
            }
            
            .additional-buttons .btn {
                width: 100%;
            }
        }
        
        /* Estilos para SweetAlert2 personalizados */
        .swal2-popup {
            border-radius: var(--border-radius) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-download"></i> Descargar Actividad</h1>
            <a href="index.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Volver a la lista de actividades
            </a>
        </header>
        
        <div class="content">
            <div class="activity-preview">
                <h2><i class="fas fa-eye"></i> Vista Previa</h2>
                <div class="preview-item">
                    <span class="preview-label">ID:</span>
                    <span class="preview-value" id="previewId">1</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Actividad:</span>
                    <span class="preview-value" id="previewActividad">Reunión de equipo</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Descripción:</span>
                    <span class="preview-value" id="previewDescripcion">Reunión semanal para revisar el progreso del proyecto</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Estado:</span>
                    <span class="preview-value">
                        <span class="status-badge status-completed" id="previewEstado">Completado</span>
                    </span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Fecha de creación:</span>
                    <span class="preview-value" id="previewFechaCreacion">15 de mayo de 2023</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">Última actualización:</span>
                    <span class="preview-value" id="previewFechaActualizacion">20 de mayo de 2023</span>
                </div>
            </div>
            
            <div class="download-options">
                <h2><i class="fas fa-file-download"></i> Opciones de Descarga</h2>
                <div class="options-grid">
                    <div class="option-card">
                        <i class="fas fa-file-pdf option-icon" style="color: #e74c3c;"></i>
                        <h3>Ver PDF</h3>
                        <p>Ver la actividad en formato PDF en una nueva ventana</p>
                        <button type="button" id="btnVerPDF" class="btn btn-info">
                            <i class="fas fa-external-link-alt"></i> Ver PDF
                        </button>
                    </div>
                    
                    <div class="option-card">
                        <i class="fas fa-download option-icon" style="color: #34495e;"></i>
                        <h3>Descargar PDF</h3>
                        <p>Descargar la actividad en formato PDF a tu dispositivo</p>
                        <button type="button" id="btnDescargarPDF" class="btn btn-dark">
                            <i class="fas fa-download"></i> Descargar PDF
                        </button>
                    </div>
                    
                    <div class="option-card">
                        <i class="fas fa-file-alt option-icon" style="color: #3498db;"></i>
                        <h3>Descargar Texto</h3>
                        <p>Descargar la actividad en formato de texto plano</p>
                        <button type="button" id="btnDescargarTXT" class="btn btn-success">
                            <i class="fas fa-download"></i> Descargar TXT
                        </button>
                    </div>
                    
                    <div class="option-card">
                        <i class="fas fa-file-csv option-icon" style="color: #27ae60;"></i>
                        <h3>Descargar CSV</h3>
                        <p>Descargar la actividad en formato CSV para hojas de cálculo</p>
                        <button type="button" id="btnDescargarCSV" class="btn btn-warning">
                            <i class="fas fa-download"></i> Descargar CSV
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="additional-options">
                <h3><i class="fas fa-cog"></i> Opciones Adicionales</h3>
                <div class="additional-buttons">
                    <button type="button" id="btnImprimir" class="btn btn-info">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button type="button" id="btnCompartir" class="btn btn-success">
                        <i class="fas fa-share-alt"></i> Compartir
                    </button>
                    <button type="button" id="btnEnviarEmail" class="btn btn-dark">
                        <i class="fas fa-envelope"></i> Enviar por Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- jsPDF (UMD) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Datos de ejemplo para la actividad
        const actividadEjemplo = {
            id: 1,
            nombre: "Reunión de equipo",
            descripcion: "Reunión semanal para revisar el progreso del proyecto y planificar las próximas tareas",
            estado: "completed",
            fechaCreacion: "2023-05-15",
            fechaActualizacion: "2023-05-20"
        };
        
        document.addEventListener('DOMContentLoaded', function () {
            // Cargar datos de ejemplo en la vista previa
            cargarVistaPrevia();
            
            // Ver PDF en nueva pestaña
            document.getElementById('btnVerPDF').addEventListener('click', function() {
                try {
                    const doc = crearPDF();
                    const url = doc.output('bloburl');
                    window.open(url, '_blank');
                    
                    // Mostrar notificación
                    Swal.fire({
                        icon: 'success',
                        title: 'PDF generado',
                        text: 'El PDF se ha abierto en una nueva pestaña',
                        confirmButtonColor: '#3498db'
                    });
                } catch (err) {
                    console.error(err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'No se pudo generar el PDF',
                        confirmButtonColor: '#e74c3c'
                    });
                }
            });

            // Descargar PDF
            document.getElementById('btnDescargarPDF').addEventListener('click', function() {
                try {
                    const doc = crearPDF();
                    doc.save('actividad.pdf');
                    
                    // Mostrar notificación
                    Swal.fire({
                        icon: 'success',
                        title: 'PDF descargado',
                        text: 'El PDF se ha descargado correctamente',
                        confirmButtonColor: '#3498db'
                    });
                } catch (err) {
                    console.error(err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'No se pudo descargar el PDF',
                        confirmButtonColor: '#e74c3c'
                    });
                }
            });
            
            // Descargar TXT
            document.getElementById('btnDescargarTXT').addEventListener('click', function() {
                try {
                    const actividad = actividadEjemplo.nombre;
                    const descripcion = actividadEjemplo.descripcion;
                    const estado = obtenerTextoEstado(actividadEjemplo.estado);
                    
                    const contenido = `ACTIVIDAD\n\n` +
                                     `ID: ${actividadEjemplo.id}\n` +
                                     `Actividad: ${actividad}\n` +
                                     `Descripción: ${descripcion}\n` +
                                     `Estado: ${estado}\n` +
                                     `Fecha de creación: ${formatearFecha(actividadEjemplo.fechaCreacion)}\n` +
                                     `Fecha de actualización: ${formatearFecha(actividadEjemplo.fechaActualizacion)}\n\n` +
                                     `Generado: ${new Date().toLocaleString()}`;
                    
                    const blob = new Blob([contenido], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'actividad.txt';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Mostrar notificación
                    Swal.fire({
                        icon: 'success',
                        title: 'Texto descargado',
                        text: 'El archivo de texto se ha descargado correctamente',
                        confirmButtonColor: '#3498db'
                    });
                } catch (err) {
                    console.error(err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'No se pudo descargar el archivo de texto',
                        confirmButtonColor: '#e74c3c'
                    });
                }
            });
            
            // Descargar CSV
            document.getElementById('btnDescargarCSV').addEventListener('click', function() {
                try {
                    const estado = obtenerTextoEstado(actividadEjemplo.estado);
                    
                    const contenido = `ID,Actividad,Descripción,Estado,Fecha de creación,Fecha de actualización\n` +
                                     `${actividadEjemplo.id},"${actividadEjemplo.nombre}","${actividadEjemplo.descripcion}",${estado},${actividadEjemplo.fechaCreacion},${actividadEjemplo.fechaActualizacion}`;
                    
                    const blob = new Blob([contenido], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'actividad.csv';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Mostrar notificación
                    Swal.fire({
                        icon: 'success',
                        title: 'CSV descargado',
                        text: 'El archivo CSV se ha descargado correctamente',
                        confirmButtonColor: '#3498db'
                    });
                } catch (err) {
                    console.error(err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'No se pudo descargar el archivo CSV',
                        confirmButtonColor: '#e74c3c'
                    });
                }
            });
            
            // Imprimir
            document.getElementById('btnImprimir').addEventListener('click', function() {
                window.print();
            });
            
            // Compartir
            document.getElementById('btnCompartir').addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: actividadEjemplo.nombre,
                        text: actividadEjemplo.descripcion,
                        url: window.location.href
                    })
                    .then(() => console.log('Compartido exitosamente'))
                    .catch((error) => console.log('Error al compartir', error));
                } else {
                    Swal.fire({
                        icon: 'info',
                        title: 'Compartir',
                        text: 'Tu navegador no soporta la función de compartir nativa',
                        confirmButtonColor: '#3498db'
                    });
                }
            });
            
            // Enviar por Email
            document.getElementById('btnEnviarEmail').addEventListener('click', function() {
                const subject = `Actividad: ${actividadEjemplo.nombre}`;
                const body = `Hola,\n\nTe comparto la siguiente actividad:\n\n` +
                            `ID: ${actividadEjemplo.id}\n` +
                            `Actividad: ${actividadEjemplo.nombre}\n` +
                            `Descripción: ${actividadEjemplo.descripcion}\n` +
                            `Estado: ${obtenerTextoEstado(actividadEjemplo.estado)}\n` +
                            `Fecha de creación: ${formatearFecha(actividadEjemplo.fechaCreacion)}\n` +
                            `Fecha de actualización: ${formatearFecha(actividadEjemplo.fechaActualizacion)}\n\n` +
                            `Saludos.`;
                
                window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            });
        });
        
        function cargarVistaPrevia() {
            document.getElementById('previewId').textContent = actividadEjemplo.id;
            document.getElementById('previewActividad').textContent = actividadEjemplo.nombre;
            document.getElementById('previewDescripcion').textContent = actividadEjemplo.descripcion;
            
            const estadoTexto = obtenerTextoEstado(actividadEjemplo.estado);
            const estadoElemento = document.getElementById('previewEstado');
            estadoElemento.textContent = estadoTexto;
            estadoElemento.className = 'status-badge';
            
            if (actividadEjemplo.estado === 'pending') {
                estadoElemento.classList.add('status-pending');
            } else if (actividadEjemplo.estado === 'inprogress') {
                estadoElemento.classList.add('status-inprogress');
            } else {
                estadoElemento.classList.add('status-completed');
            }
            
            document.getElementById('previewFechaCreacion').textContent = formatearFecha(actividadEjemplo.fechaCreacion);
            document.getElementById('previewFechaActualizacion').textContent = formatearFecha(actividadEjemplo.fechaActualizacion);
        }
        
        function crearPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const marginLeft = 15;
            let y = 20;
            const lineHeight = 8;
            
            // Título
            doc.setFontSize(20);
            doc.setTextColor(52, 152, 219);
            doc.text('DETALLES DE ACTIVIDAD', marginLeft, y);
            
            // Línea separadora
            y += 10;
            doc.setDrawColor(200, 200, 200);
            doc.line(marginLeft, y, 200, y);
            
            // Contenido
            y += 15;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            doc.setFont(undefined, 'bold');
            doc.text('ID:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            doc.text(actividadEjemplo.id.toString(), marginLeft + 20, y);
            
            y += lineHeight + 2;
            doc.setFont(undefined, 'bold');
            doc.text('Actividad:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            doc.text(actividadEjemplo.nombre, marginLeft + 30, y);
            
            y += lineHeight + 2;
            doc.setFont(undefined, 'bold');
            doc.text('Descripción:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            
            // Manejar descripción larga
            const descLines = doc.splitTextToSize(actividadEjemplo.descripcion, 180);
            doc.text(descLines, marginLeft + 35, y);
            y += (descLines.length * lineHeight);
            
            y += lineHeight;
            doc.setFont(undefined, 'bold');
            doc.text('Estado:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            doc.text(obtenerTextoEstado(actividadEjemplo.estado), marginLeft + 25, y);
            
            y += lineHeight + 2;
            doc.setFont(undefined, 'bold');
            doc.text('Fecha de creación:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            doc.text(formatearFecha(actividadEjemplo.fechaCreacion), marginLeft + 55, y);
            
            y += lineHeight + 2;
            doc.setFont(undefined, 'bold');
            doc.text('Fecha de actualización:', marginLeft, y);
            doc.setFont(undefined, 'normal');
            doc.text(formatearFecha(actividadEjemplo.fechaActualizacion), marginLeft + 65, y);
            
            // Pie de página
            y = 280;
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text(`Generado el: ${new Date().toLocaleString()}`, marginLeft, y);

            return doc;
        }
        
        function obtenerTextoEstado(estado) {
            switch(estado) {
                case 'pending': return 'Pendiente';
                case 'inprogress': return 'En progreso';
                case 'completed': return 'Completado';
                default: return 'Desconocido';
            }
        }
        
        function formatearFecha(fechaString) {
            const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(fechaString).toLocaleDateString('es-ES', opciones);
        }
        
        // Función para descargar actividad (para integración con tu código existente)
        function DescargarActividad() {
            console.log("Función DescargarActividad inicializada");
            // Esta función se integraría con tu lógica existente en main.js
        }
    </script>
</body>
</html>